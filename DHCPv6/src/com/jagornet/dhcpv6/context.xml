<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC
	"-//SPRING//DTD BEAN//EN"
	"http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

	<bean id="propertyConfigurer" 
		  class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="location">
			<value>classpath:jdbc.properties</value>
    	</property>
  	</bean>

  	<bean id="dataSource" 
  		  class="org.springframework.jdbc.datasource.DriverManagerDataSource">
		<property name="driverClassName">    
			<value>${jdbc.driver}</value>
		</property>
		<property name="url">
	  		<value>${jdbc.url}</value>
		</property>
		<property name="username">
			<value>${jdbc.user}</value>
		</property>
		<property name="password">
			<value>${jdbc.password}</value>
		</property>
  	</bean>

	<bean id="naAddrBindingManager" 
  		  class="com.jagornet.dhcpv6.server.request.binding.NaAddrBindingManagerImpl"
  		  autowire="byType"/>
	<bean id="taAddrBindingManager" 
  		  class="com.jagornet.dhcpv6.server.request.binding.TaAddrBindingManagerImpl"
  		  autowire="byType"/>
	<bean id="prefixBindingManager" 
  		  class="com.jagornet.dhcpv6.server.request.binding.PrefixBindingManagerImpl"
  		  autowire="byType"/>
  		
	<bean id="identityAssocDAO" 
		  class="com.jagornet.dhcpv6.db.JdbcIdentityAssocDAO" 
		  autowire="byType"/>
	<bean id="iaAddressDAO" 
		  class="com.jagornet.dhcpv6.db.JdbcIaAddressDAO" 
		  autowire="byType"/>
	<bean id="iaPrefixDAO" 
		  class="com.jagornet.dhcpv6.db.JdbcIaPrefixDAO" 
		  autowire="byType"/>
	<bean id="dhcpOptionDAO" 
		  class="com.jagornet.dhcpv6.db.JdbcDhcpOptionDAO" 
		  autowire="byType"/>

	<bean id="transactionManager" 
		  class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource">
			<ref local="dataSource"/>
		</property>
	</bean>

	<!--
	    Note use of "inner bean" for target property.
	    This ensures that there is only one instance of this
	    bean in the factory, allowing us to use autowire
	    by type if necessary.
	-->
	<bean id="iaManager" 
		  class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
    
		<property name="transactionManager">
			<ref local="transactionManager"/>
		</property>
    
		<property name="target">
			<bean class="com.jagornet.dhcpv6.db.JdbcIaManager">
				<property name="dataSource">
					<ref local="dataSource"/>
				</property>
				<property name="iaDao">
					<ref local="identityAssocDAO"/>
				</property>
				<property name="iaAddrDao">
					<ref local="iaAddressDAO"/>
				</property>
				<property name="iaPrefixDao">
					<ref local="iaPrefixDAO"/>
				</property>
				<property name="dhcpOptDao">
					<ref local="dhcpOptionDAO"/>
				</property>
			</bean>
		</property>

		<property name="transactionAttributes">
			<props>
				<prop key="*">PROPAGATION_REQUIRED</prop>
			</props>
		</property>

	</bean>

</beans>
